# 平衡機器人專案進度

## 1. 專案概述

本專案旨在開發一個基於ESP32-S3的自平衡機器人，具有以下功能：
- 使用MPU6050進行姿態感測
- 雙馬達驅動和編碼器反饋
- OLED顯示器用於狀態顯示
- 多頁面UI系統，支持切換不同的顯示頁面
- PID控制系統實現自平衡

## 2. 已完成工作

### 2.1 硬體腳位定義

- 已完成所有硬體腳位的定義，詳見config.h
  - 馬達1控制腳位 (PWM, AIN1, AIN2, ENA, ENB)
  - 馬達2控制腳位 (PWM, AIN1, AIN2, ENA, ENB)
  - 馬達共用控制腳位 (STBY)
  - MPU (慣性測量單元) 腳位
  - WS2812 燈珠腳位

### 2.2 測試I2C模組

- 已建立I2C掃描程式，用於檢測I2C設備的地址
- 已確認OLED使用的I2C地址為0x3C
- 掃描程式會在Serial監視器上顯示所有連接的I2C設備地址
- 常見的OLED地址：0x3C, 0x3D, 0x78, 0x7A
- 常見的MPU6050地址：0x68, 0x69

### 2.3 OLED顯示器測試

- 已建立OLED測試程式 `oled_sh1106_test.cpp`，用於測試SH1106型號的OLED顯示器
- 使用U8g2庫實現與SH1106控制器的正確通訊
- 解決了控制器型號混用導致的「花屏」問題（SH1106 vs SSD1306）
- 測試程式包含多種顯示功能：
  - 顯示文字
  - 繪製幾何圖形（方框、圓形）
  - 顯示自定義圖標
  - 不同字體大小的文字顯示
  - 繪製線條和點陣圖案
- 在platformio.ini中新增專用的編譯環境 `oled_sh1106_test`
- 問題解決方案已記錄在 `troubleshooting.md` 中，確保使用正確的控制器驅動

### 2.4 OLED頁面管理系統

- 已開發OLED_Manager類，實現多頁面管理系統
- 基於抽象DisplayPage類，可以輕鬆添加新頁面
- 目前已實現兩個頁面：
  - MotorPage：顯示馬達和編碼器數據
  - IMUPage：顯示IMU姿態和加速度數據，支持多種顯示模式
- 實現了頁面切換功能，通過按鈕切換頁面

## 3. 當前問題

### 3.1 OLED頁面顯示問題

- IMUPage顯示有問題，但MotorPage顯示正常
- 問題出現在OLED_Manager的drawSplashScreen函數中，嘗試訪問未初始化的頁面
- 已修復drawSplashScreen函數中的錯誤，移除了在初始化時嘗試繪製不存在頁面的代碼

## 4. 下一步計劃

### 4.1 PID控制內環參數測試

- 創建PID控制內環參數測試專案 (test/PID_Motor_Control_Test)
- 開發功能：
  1. 創建Debug OLED頁面，顯示目標RPM和當前RPM的示波器視圖
  2. 實現按下Boot按鈕增加目標RPM的功能（每次增加50 RPM）
  3. 實現PID控制器調整馬達速度以達到目標RPM
  4. 添加參數調整界面，可以實時調整PID參數

### 4.2 平衡控制系統開發

- 實現外環姿態控制PID
- 結合內環速度控制PID
- 開發自平衡算法

## 5. 文檔變更記錄

- 2025-03-13: 完成config.h腳位設定，建立I2C掃描程式
- 2025-03-15: 完成OLED顯示器測試程式，解決SH1106控制器的顯示問題
- 2025-03-18: 修復OLED_Manager的drawSplashScreen函數錯誤，解決初始化崩潰問題